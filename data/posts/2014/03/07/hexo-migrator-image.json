{"type":"post","json_base":"data/posts","json":"data/posts/2014/03/07/hexo-migrator-image.json","path":"2014/03/07/hexo-migrator-image/","data":{"title":"Hexo外链图片迁移插件","content":"<p>这两天打算把博客从Wordpress迁移到GitHub Page上，主要原因还是Wordpress的编辑不如Markdown来得爽，这个主机也不如GitHub服务器的速度和可访问性高。</p>\n<p>GitHub Pages的博客框架有很多选择，最终决定用基于Node.Js的<a href=\"https://github.com/tommy351/hexo\" target=\"_blank\" rel=\"external\">Hexo</a>，速度比官方的Jekyll系框架要快，并且不用折腾ruby。在使用<a href=\"https://github.com/hexojs/hexo-migrator-wordpress\" target=\"_blank\" rel=\"external\">hexo-migrator-wordpress</a>迁移文章后，发现所有图片依然是保持外链。翻了下Hexo的文档，自己写了个migrator迁移所有外链图片，流程很简单：</p>\n<ul>\n<li>打开所有.md文件</li>\n<li>扫描并解析Markdown插入图片的tag</li>\n<li>下载所有非本站的图片（包括本地图片）到images目录</li>\n<li>更新所有引用的url</li>\n</ul>\n<p>迁移前简单的通过对url做SHA1 hash可以避免部分图片重复，目前懒得对文件内容做对比，暂时是够用了。</p>\n<p>有了这个工具不仅能够完成迁移，以后写文章的时候也不用人肉拷贝图片算链接，只需要直接引用，发布前跑一次就行了。</p>\n<p>安装：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-migrator-image</span><br></pre></td></tr></table></figure></p>\n<p>使用：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo migrate image</span><br></pre></td></tr></table></figure></p>\n<p>源代码：<a href=\"https://github.com/akfish/hexo-migrator-image\" target=\"_blank\" rel=\"external\">hexo-migrator-image</a></p>\n","date":"2014-03-06T19:03:22.000Z","path":"2014/03/07/hexo-migrator-image/","isDark":true,"featureColor":"#266cb4","featureImage":"/image/stock/1.jpg","excerpt":"","featureSwatch":{"Vibrant":{"color":"#266cb4","isDark":true,"contrast":5.450121616568956},"Muted":{"color":"#4b70a6","isDark":true,"contrast":5.296212493095912},"DarkVibrant":{"color":"#3260a1","isDark":true,"contrast":10.521199995853594},"DarkMuted":{"color":"#515787","isDark":true,"contrast":11.462157427934459},"LightVibrant":{"color":"#5791c6","isDark":true,"contrast":3.512948192359975},"LightMuted":{"color":"#9bb4cc","isDark":false,"contrast":2.144138719552091}},"json":"data/posts/2014/03/07/hexo-migrator-image.json","tags":[{"name":"CoffeeScript","slug":"CoffeeScript","path":"tags/CoffeeScript/","permalink":"http://catx.me/tags/CoffeeScript/","postCount":9},{"name":"GitHub","slug":"GitHub","path":"tags/GitHub/","permalink":"http://catx.me/tags/GitHub/","postCount":9},{"name":"Hexo","slug":"Hexo","path":"tags/Hexo/","permalink":"http://catx.me/tags/Hexo/","postCount":4},{"name":"Node.Js","slug":"Node-Js","path":"tags/Node-Js/","permalink":"http://catx.me/tags/Node-Js/","postCount":4}],"categories":[{"name":"挨踢","slug":"挨踢","path":"categories/挨踢/","permalink":"http://catx.me/categories/挨踢/","postCount":24}]},"sha1":"77a22e51bc5cb918023e69e427c7e047abe5dd4f","prev":{"title":"Hexo站点迁移主题","content":"<h2 id=\"u4ECB_u7ECD\"><a href=\"#u4ECB_u7ECD\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>今天把博客从<code>blog.catx.me</code>迁移到了<code>catx.me</code>，并关闭了原来的wordpress博客，算是完成了迁移的工作。<br>由于在过渡期也有若干个项目引用了博客的URL，所以迁移最后需要解决的问题是改变域名过后的重定向。<br>重定向包括两个方面：</p>\n<ul>\n<li>通过原URL的访客不会死链，会自动跳转到新URL</li>\n<li>搜索引擎能自动重新索引，不会降低页面排名</li>\n</ul>\n<p>实现的原理就是在每个页面的<code>&lt;head&gt;</code>部分添加两个标签：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">meta</span> <span class=\"attribute\">http-equiv</span>=<span class=\"value\">\"refresh\"</span> <span class=\"attribute\">content</span>=<span class=\"value\">\"0; url=http://new.domain.com/same/relative/url/of/old/site/\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">link</span> <span class=\"attribute\">rel</span>=<span class=\"value\">\"canonical\"</span> <span class=\"attribute\">href</span>=<span class=\"value\">\"http://new.domain.com/same/relative/url/of/old/site/\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第一个是给人看的，第二个是给机器看的。</p>\n<p>前者会自动让浏览器跳转到新的域名，后者在搜索引擎的bot下次抓取页面的时候读取，重新索引到新的URL。</p>\n<p>对于较大的站点，人肉在每个页面的标签很是麻烦，于是做了一个hexo的主题来实现这样一个功能（当然也有其他方式，不过主题是最简单的）。这并不是一个真正的主题，因为没有任何内容会被访问者看到。这个主题唯一的用途就是生成一个结构完全相同的站点，把每个页面重定向到一个新的域名上。</p>\n<h2 id=\"u4F7F_u7528\"><a href=\"#u4F7F_u7528\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>以把在<code>blog.catx.me</code>上的站点迁移到<code>catx.me</code>上为例，创建repo、修改DNS、修改CNAME这些部署上的细节大同小异而又千变万化，不在此说明，过程如下：</p>\n<ul>\n<li>创建一个hexo博客文件夹的副本</li>\n<li>在副本文件夹中安装这个主题：</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git clone https://github.com/akfish/hexo-theme-redirect.git themes/redirect</span><br></pre></td></tr></table></figure>\n<ul>\n<li>修改副本站点的<code>_config.yml</code>文件，使用主题：</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">theme: redirect</span><br></pre></td></tr></table></figure>\n<ul>\n<li>修改副本站点的<code>_config.yml</code>文件，添加如下行指定新域名：</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">new_domain: catx.me</span><br></pre></td></tr></table></figure>\n<ul>\n<li>修改副本站点的部署配置，部署到<code>blog.catx.me</code>(老域名)</li>\n<li>修改原站点的部署配置，部署到<code>catx.me</code>(新域名)</li>\n</ul>\n<p>这样就完成了迁移工作，比如访问<a href=\"http://blog.catx.me\" target=\"_blank\" rel=\"external\">http://blog.catx.me</a>就会自动跳转到<a href=\"http://catx.me\">http://catx.me</a></p>\n<h2 id=\"u5176_u5B83\"><a href=\"#u5176_u5B83\" class=\"headerlink\" title=\"其它\"></a>其它</h2><p>如果你的站点部署在GitHub Pages上，老域名恰好在<code>yourname.github.io</code> repo的<code>CNAME</code>绑定过，那么你其它项目的GitHub Pages的URL也需要设置跳转。</p>\n<p>比如有个项目<code>foo</code>，原有的gh-pages地址就是<code>http://blog.catx.me/foo</code>，那么就可以在副本站点中运行：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new page foo</span><br></pre></td></tr></table></figure>\n<p>部署后就能实现跳转。需要注意的是，hexo生成的页面路径全是小写，如果服务器是区分大小写的，就需要手动在<code>source</code>里修改成正确的形式。</p>\n<h2 id=\"u6E90_u4EE3_u7801\"><a href=\"#u6E90_u4EE3_u7801\" class=\"headerlink\" title=\"源代码\"></a>源代码</h2><p><a href=\"https://github.com/akfish/hexo-theme-redirect\" target=\"_blank\" rel=\"external\">hexo-theme-redirect</a></p>\n","date":"2014-03-19T16:02:33.000Z","path":"2014/03/20/hexo-site-migration-theme/","isDark":true,"featureColor":"#2b6a7d","featureImage":"/image/stock/3.jpg","excerpt":"","featureSwatch":{"Vibrant":{"color":"#2b6a7d","isDark":true,"contrast":6.152506571402196},"Muted":{"color":"#628d9b","isDark":true,"contrast":3.8818866665042275},"DarkVibrant":{"color":"#08536a","isDark":true,"contrast":13.30121420712154},"DarkMuted":{"color":"#4d7e8e","isDark":true,"contrast":4.693454244598322},"LightVibrant":{"color":"#74d4e4","isDark":false,"contrast":1.7100585291773622},"LightMuted":{"color":"#769ca9","isDark":false,"contrast":2.958324937392382}},"json":"data/posts/2014/03/20/hexo-site-migration-theme.json","tags":[{"name":"Hexo","slug":"Hexo","path":"tags/Hexo/","permalink":"http://catx.me/tags/Hexo/","postCount":4},{"name":"migiration","slug":"migiration","path":"tags/migiration/","permalink":"http://catx.me/tags/migiration/","postCount":1},{"name":"theme","slug":"theme","path":"tags/theme/","permalink":"http://catx.me/tags/theme/","postCount":1}],"categories":[{"name":"挨踢","slug":"挨踢","path":"categories/挨踢/","permalink":"http://catx.me/categories/挨踢/","postCount":24}]},"next":{"title":"Hexo MathJax插件","content":"<div id=\"badge-container-akfish-hexo-math-6e264f5\" class=\"hexo-github\" style=\"width: 100%\"></div>\n<script src=\"/hexo-github/badge.js\"></script>\n<script type=\"text/javascript\">\n  loadStyle(\"/hexo-github/style.css\");\n  loadStyle(\"/hexo-github/octicons/octicons.css\");\n  new Badge(\"#badge-container-akfish-hexo-math-6e264f5\", \"akfish\", \"hexo-math\", \"6e264f5\", false);\n</script>\n\n<h2 id=\"u4ECB_u7ECD\"><a href=\"#u4ECB_u7ECD\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>Hexo不支持数学公式，网上可以找到很多人肉修改theme使其支持用<a href=\"http://www.mathjax.org/\" target=\"_blank\" rel=\"external\">MathJax</a>渲染公式的方法，主要分为两个步骤：</p>\n<ul>\n<li>在theme的header中插入对MathJax CDN script的引用，并配置inline math</li>\n<li>在文章中用inline math插入公式</li>\n</ul>\n<p>这个方法有两个明显的缺点：</p>\n<ul>\n<li>需要人肉进行的工作太多</li>\n<li>遇到特殊符号需要人肉escape，否则会被markdown parser吃掉</li>\n</ul>\n<p>于是开发了一个插件，实现：</p>\n<ul>\n<li>自动部署MathJax</li>\n<li>添加MathJax Tag</li>\n</ul>\n<h2 id=\"u5B89_u88C5\"><a href=\"#u5B89_u88C5\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-math --save</span><br></pre></td></tr></table></figure>\n<h2 id=\"u521D_u59CB_u5316\"><a href=\"#u521D_u59CB_u5316\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><p>在blog文件夹中执行：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo math install</span><br></pre></td></tr></table></figure>\n<p>在<code>_config.yml</code>文件中添加：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins:&#10;- hexo-math</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"u4F7F_u7528\"><a href=\"#u4F7F_u7528\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>对于不含特殊符号的公式，可以直接使用MathJax的inline math表达式.<br>如果含有特殊符号，则需要人肉escape，如<code>\\</code>之类的特殊符号在LaTex表达式中出现频率很高，这样就很麻烦，使用tag能够省不少事。</p>\n<p><strong>MathJax Inline:</strong></p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Simple inline $a = b + c$.</span><br></pre></td></tr></table></figure>\n<p>效果：</p>\n<p>Simple inline $a = b + c$.</p>\n<p><strong>MathJax Block:</strong><br><figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$$\\frac&#123;\\partial u&#125;&#123;\\partial t&#125;</span><br><span class=\"line\">= h^2 \\left( \\frac&#123;\\partial^2 u&#125;&#123;\\partial x^2&#125; +</span><br><span class=\"line\">\\frac&#123;\\partial^2 u&#125;&#123;\\partial y^2&#125; +</span><br><span class=\"line\">\\frac&#123;\\partial^2 u&#125;&#123;\\partial z^2&#125;\\right)$$</span><br></pre></td></tr></table></figure></p>\n<p>效果：</p>\n<p>$$\\frac{\\partial u}{\\partial t}<br>= h^2 \\left( \\frac{\\partial^2 u}{\\partial x^2} +<br>\\frac{\\partial^2 u}{\\partial y^2} +<br>\\frac{\\partial^2 u}{\\partial z^2}\\right)$$</p>\n<p><strong>Tag inline:</strong></p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">This equation &#123;&amp;#37; math \\cos 2\\theta = \\cos^2 \\theta - \\sin^2 \\theta =  2 \\cos^2 \\theta - 1 %&#125; is inline.</span><br></pre></td></tr></table></figure>\n<p>效果：</p>\n<p>This equation <span>$\\cos 2\\theta = \\cos^2 \\theta - \\sin^2 \\theta =  2 \\cos^2 \\theta - 1$</span><!-- Has MathJax --> is inline.</p>\n<p><strong>Tag Block:</strong><br><figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&amp;#37; math_block %&#125;</span><br><span class=\"line\">\\begin&#123;aligned&#125;</span><br><span class=\"line\">\\dot&#123;x&#125; &amp; = \\sigma(y-x) \\\\</span><br><span class=\"line\">\\dot&#123;y&#125; &amp; = \\rho x - y - xz \\\\</span><br><span class=\"line\">\\dot&#123;z&#125; &amp; = -\\beta z + xy</span><br><span class=\"line\">\\end&#123;aligned&#125;</span><br><span class=\"line\">&#123;&amp;#37; endmath_block %&#125;</span><br></pre></td></tr></table></figure></p>\n<p>效果：</p>\n<span>$$\\begin{aligned}\n\\dot{x} & = \\sigma(y-x) \\\\\n\\dot{y} & = \\rho x - y - xz \\\\\n\\dot{z} & = -\\beta z + xy\n\\end{aligned}$$</span><!-- Has MathJax -->\n<h2 id=\"u6E90_u4EE3_u7801\"><a href=\"#u6E90_u4EE3_u7801\" class=\"headerlink\" title=\"源代码\"></a>源代码</h2><p><a href=\"https://github.com/akfish/hexo-math\" target=\"_blank\" rel=\"external\">GitHub</a></p>\n","date":"2014-03-08T19:08:10.000Z","path":"2014/03/09/hexo-mathjax-plugin/","isDark":true,"featureColor":"#266cb4","featureImage":"/image/stock/1.jpg","excerpt":"","featureSwatch":{"Vibrant":{"color":"#266cb4","isDark":true,"contrast":5.450121616568956},"Muted":{"color":"#4b70a6","isDark":true,"contrast":5.296212493095912},"DarkVibrant":{"color":"#3260a1","isDark":true,"contrast":10.521199995853594},"DarkMuted":{"color":"#515787","isDark":true,"contrast":11.462157427934459},"LightVibrant":{"color":"#5791c6","isDark":true,"contrast":3.512948192359975},"LightMuted":{"color":"#9bb4cc","isDark":false,"contrast":2.144138719552091}},"json":"data/posts/2014/03/09/hexo-mathjax-plugin.json","tags":[{"name":"CoffeeScript","slug":"CoffeeScript","path":"tags/CoffeeScript/","permalink":"http://catx.me/tags/CoffeeScript/","postCount":9},{"name":"GitHub","slug":"GitHub","path":"tags/GitHub/","permalink":"http://catx.me/tags/GitHub/","postCount":9},{"name":"Hexo","slug":"Hexo","path":"tags/Hexo/","permalink":"http://catx.me/tags/Hexo/","postCount":4},{"name":"Node.Js","slug":"Node-Js","path":"tags/Node-Js/","permalink":"http://catx.me/tags/Node-Js/","postCount":4}],"categories":[{"name":"挨踢","slug":"挨踢","path":"categories/挨踢/","permalink":"http://catx.me/categories/挨踢/","postCount":24}]}}