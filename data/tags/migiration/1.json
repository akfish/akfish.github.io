{"tag":"migiration","isDark":false,"type":"tag","path":"tags/migiration/","json_base":"data/tags/migiration/","json":"data/tags/migiration/1.json","current":1,"total":1,"posts":[{"type":"post","json_base":"data/posts","json":"data/posts/2014/03/20/hexo-site-migration-theme.json","path":"2014/03/20/hexo-site-migration-theme/","data":{"title":"Hexo站点迁移主题","content":"<h2 id=\"u4ECB_u7ECD\"><a href=\"#u4ECB_u7ECD\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>今天把博客从<code>blog.catx.me</code>迁移到了<code>catx.me</code>，并关闭了原来的wordpress博客，算是完成了迁移的工作。<br>由于在过渡期也有若干个项目引用了博客的URL，所以迁移最后需要解决的问题是改变域名过后的重定向。<br>重定向包括两个方面：</p>\n<ul>\n<li>通过原URL的访客不会死链，会自动跳转到新URL</li>\n<li>搜索引擎能自动重新索引，不会降低页面排名</li>\n</ul>\n<p>实现的原理就是在每个页面的<code>&lt;head&gt;</code>部分添加两个标签：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">meta</span> <span class=\"attribute\">http-equiv</span>=<span class=\"value\">\"refresh\"</span> <span class=\"attribute\">content</span>=<span class=\"value\">\"0; url=http://new.domain.com/same/relative/url/of/old/site/\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">link</span> <span class=\"attribute\">rel</span>=<span class=\"value\">\"canonical\"</span> <span class=\"attribute\">href</span>=<span class=\"value\">\"http://new.domain.com/same/relative/url/of/old/site/\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第一个是给人看的，第二个是给机器看的。</p>\n<p>前者会自动让浏览器跳转到新的域名，后者在搜索引擎的bot下次抓取页面的时候读取，重新索引到新的URL。</p>\n<p>对于较大的站点，人肉在每个页面的标签很是麻烦，于是做了一个hexo的主题来实现这样一个功能（当然也有其他方式，不过主题是最简单的）。这并不是一个真正的主题，因为没有任何内容会被访问者看到。这个主题唯一的用途就是生成一个结构完全相同的站点，把每个页面重定向到一个新的域名上。</p>\n<h2 id=\"u4F7F_u7528\"><a href=\"#u4F7F_u7528\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>以把在<code>blog.catx.me</code>上的站点迁移到<code>catx.me</code>上为例，创建repo、修改DNS、修改CNAME这些部署上的细节大同小异而又千变万化，不在此说明，过程如下：</p>\n<ul>\n<li>创建一个hexo博客文件夹的副本</li>\n<li>在副本文件夹中安装这个主题：</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git clone https://github.com/akfish/hexo-theme-redirect.git themes/redirect</span><br></pre></td></tr></table></figure>\n<ul>\n<li>修改副本站点的<code>_config.yml</code>文件，使用主题：</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">theme: redirect</span><br></pre></td></tr></table></figure>\n<ul>\n<li>修改副本站点的<code>_config.yml</code>文件，添加如下行指定新域名：</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">new_domain: catx.me</span><br></pre></td></tr></table></figure>\n<ul>\n<li>修改副本站点的部署配置，部署到<code>blog.catx.me</code>(老域名)</li>\n<li>修改原站点的部署配置，部署到<code>catx.me</code>(新域名)</li>\n</ul>\n<p>这样就完成了迁移工作，比如访问<a href=\"http://blog.catx.me\" target=\"_blank\" rel=\"external\">http://blog.catx.me</a>就会自动跳转到<a href=\"http://catx.me\">http://catx.me</a></p>\n<h2 id=\"u5176_u5B83\"><a href=\"#u5176_u5B83\" class=\"headerlink\" title=\"其它\"></a>其它</h2><p>如果你的站点部署在GitHub Pages上，老域名恰好在<code>yourname.github.io</code> repo的<code>CNAME</code>绑定过，那么你其它项目的GitHub Pages的URL也需要设置跳转。</p>\n<p>比如有个项目<code>foo</code>，原有的gh-pages地址就是<code>http://blog.catx.me/foo</code>，那么就可以在副本站点中运行：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new page foo</span><br></pre></td></tr></table></figure>\n<p>部署后就能实现跳转。需要注意的是，hexo生成的页面路径全是小写，如果服务器是区分大小写的，就需要手动在<code>source</code>里修改成正确的形式。</p>\n<h2 id=\"u6E90_u4EE3_u7801\"><a href=\"#u6E90_u4EE3_u7801\" class=\"headerlink\" title=\"源代码\"></a>源代码</h2><p><a href=\"https://github.com/akfish/hexo-theme-redirect\" target=\"_blank\" rel=\"external\">hexo-theme-redirect</a></p>\n","date":"2014-03-19T16:02:33.000Z","path":"2014/03/20/hexo-site-migration-theme/","isDark":false,"featureColor":"#a99a48","featureImage":"/image/stock/7.jpg","excerpt":"","featureSwatch":{"Vibrant":{"color":"#a99a48","isDark":false,"contrast":2.8607233160176517},"Muted":{"color":"#b7ac6a","isDark":false,"contrast":2.3019786002998246},"DarkVibrant":{"color":"#8a7133","isDark":true,"contrast":4.70318580028283},"DarkMuted":{"color":"#534c37","isDark":true,"contrast":14.371837375676147},"LightVibrant":{"color":"#e4dcc3","isDark":false,"contrast":1.3703902496024831},"LightMuted":{"color":"#aba790","isDark":false,"contrast":2.4244396488445554}},"permalink":"http://catx.me/2014/03/20/hexo-site-migration-theme/","json":"data/posts/2014/03/20/hexo-site-migration-theme.json","tags":[{"name":"Hexo","slug":"Hexo","path":"tags/Hexo/","permalink":"http://catx.me/tags/Hexo/","postCount":3},{"name":"migiration","slug":"migiration","path":"tags/migiration/","permalink":"http://catx.me/tags/migiration/","postCount":1},{"name":"theme","slug":"theme","path":"tags/theme/","permalink":"http://catx.me/tags/theme/","postCount":1}],"categories":[{"name":"挨踢","slug":"挨踢","path":"categories/挨踢/","permalink":"http://catx.me/categories/挨踢/","postCount":17}]},"sha1":"3c11538c5a3ae4caa2ba91dda0fecd69b29ef89b","isDigest":true}],"sha1":"7f9e027e91939d14eff7453830134a9bca404e8f"}