{"tag":"Visual Studio 2012","isDark":false,"type":"tag","path":"tags/Visual-Studio-2012/","json_base":"data/tags/Visual-Studio-2012/","json":"data/tags/Visual-Studio-2012/1.json","current":1,"total":1,"posts":[{"type":"post","json_base":"data/posts","json":"data/posts/2014/02/08/visual-studio-gplex-gppg-project-config.json","path":"2014/02/08/visual-studio-gplex-gppg-project-config/","data":{"title":"Visual Studio GPLEX/GPPG配置","content":"<p>入手实现Coffee#（CoffeeScript for .Net）的编译器时，发现了<a href=\"http://gplex.codeplex.com\" target=\"_blank\" rel=\"external\">GPLEX</a>和<a href=\"http://gppg.codeplex.com/\" target=\"_blank\" rel=\"external\">GPPG</a>这一对.Net环境下类Lex和Yacc的工具，用于自动生成C#实现的Scanner和Parser，可以快速的构建编译器的前端部分。使用时需要编写.lex（词法描述）和.y（语法描述）文件，调用工具生成.cs文件，加入到工程中编译。</p>\n<p>通过修改csproject文件的配置，可以让vs自动处理.lex/.y文件的生成以及依赖关系。工程目录结构如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CoffeeSharp&#10; &#9500;&#9472;documents&#10; &#9500;&#9472;src&#10; &#9474; &#9492;&#9472;CoffeeSharp&#10; &#9474; &#9500;&#9472;CoffeeSharp.csproj&#10; &#9474; &#9500;&#9472;Scanner.lex&#10; &#9474; &#9500;&#9472;Scanner.cs&#10; &#9474; &#9500;&#9472;Parser.y&#10; &#9474; &#9500;&#9472;Parser.cs&#10; &#9474; &#9492;&#9472;...&#10; &#9492;&#9472;tools&#10; &#9500;&#9472;gppg.exe&#10; &#9492;&#9472;gplex.exe</span><br></pre></td></tr></table></figure>\n<p>编辑CoffeeScript.csproj文件：</p>\n<p>1. 添加依赖关系：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&amp;lt;!-- Generated with GPLEX and GPPG--&amp;gt;</span><br><span class=\"line\">&amp;lt;ItemGroup&amp;gt;</span><br><span class=\"line\">  &amp;lt;Compile Include=\"Scanner.cs\"&amp;gt;</span><br><span class=\"line\">    &amp;lt;AutoGen&amp;gt;True&amp;lt;/AutoGen&amp;gt;</span><br><span class=\"line\">    &amp;lt;DependentUpon&amp;gt;Scanner.lex&amp;lt;/DependentUpon&amp;gt;</span><br><span class=\"line\">  &amp;lt;/Compile&amp;gt;</span><br><span class=\"line\">  &amp;lt;Compile Include=\"Parser.cs\"&amp;gt;</span><br><span class=\"line\">    &amp;lt;AutoGen&amp;gt;True&amp;lt;/AutoGen&amp;gt;</span><br><span class=\"line\">    &amp;lt;DependentUpon&amp;gt;Parser.y&amp;lt;/DependentUpon&amp;gt;</span><br><span class=\"line\">  &amp;lt;/Compile&amp;gt;</span><br><span class=\"line\">&amp;lt;/ItemGroup&amp;gt;</span><br></pre></td></tr></table></figure>\n<p>2. 创建Lex/Yacc Target（修改原有的.lex/.y文件项）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&amp;lt;!-- Lexer And Parser Specification Files --&amp;gt;</span><br><span class=\"line\">&amp;lt;ItemGroup&amp;gt;</span><br><span class=\"line\">  &amp;lt;Lex Include=\"Scanner.lex\" /&amp;gt;</span><br><span class=\"line\">  &amp;lt;Yacc Include=\"Parser.y\" /&amp;gt;</span><br><span class=\"line\">&amp;lt;/ItemGroup&amp;gt;</span><br></pre></td></tr></table></figure>\n<p>3. 设置Target生成规则，命令行根据实际情况修改</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&amp;lt;!-- Lex Target --&amp;gt;</span><br><span class=\"line\">&amp;lt;Target Name=\"LexGenerator\" Inputs=\"@(Lex)\" Outputs=\"@(Lex-&amp;gt;'%(RelativeDir)%(Filename).cs')\"&amp;gt;</span><br><span class=\"line\">  &amp;lt;Exec Command=\"$(SolutionDir)..\\tools\\gplex.exe /unicode /out:@(Lex -&amp;gt;'%(RelativeDir)%(Filename).cs') %(Lex.Identity)\" /&amp;gt;</span><br><span class=\"line\">  &amp;lt;CreateItem Include=\"%(Lex.RelativeDir)%(Lex.Filename).cs\"&amp;gt;</span><br><span class=\"line\">    &amp;lt;Output TaskParameter=\"Include\" ItemName=\"FileWrites\" /&amp;gt;</span><br><span class=\"line\">  &amp;lt;/CreateItem&amp;gt;</span><br><span class=\"line\">&amp;lt;/Target&amp;gt;</span><br><span class=\"line\">&amp;lt;!-- Yacc Target --&amp;gt;</span><br><span class=\"line\">&amp;lt;Target Name=\"YaccGenerator\" Inputs=\"@(Yacc)\" Outputs=\"@(Yacc-&amp;gt;'%(RelativeDir)%(Filename).cs')\"&amp;gt;</span><br><span class=\"line\">  &amp;lt;Exec Command=\"$(SolutionDir)..\\tools\\gppg.exe /gplex /out:@(Yacc -&amp;gt;'%(RelativeDir)%(Filename).cs') %(Yacc.Identity)\" /&amp;gt;</span><br><span class=\"line\">  &amp;lt;CreateItem Include=\"%(Yacc.RelativeDir)%(Yacc.Filename).cs\"&amp;gt;</span><br><span class=\"line\">    &amp;lt;Output TaskParameter=\"Include\" ItemName=\"FileWrites\" /&amp;gt;</span><br><span class=\"line\">  &amp;lt;/CreateItem&amp;gt;</span><br><span class=\"line\">&amp;lt;/Target&amp;gt;</span><br></pre></td></tr></table></figure>\n<p>4. 设置依赖关系</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&amp;lt;PropertyGroup&amp;gt;</span><br><span class=\"line\">    &amp;lt;BuildDependsOn&amp;gt;LexGenerator;YaccGenerator;$(BuildDependsOn)&amp;lt;/BuildDependsOn&amp;gt;</span><br><span class=\"line\">    &amp;lt;CompileDependsOn&amp;gt;LexGenerator;YaccGenerator;$(CompileDependsOn)&amp;lt;/CompileDependsOn&amp;gt;</span><br><span class=\"line\">  &amp;lt;/PropertyGroup&amp;gt;</span><br></pre></td></tr></table></figure>\n<p>重新载入工程文件，会看到生成的.cs文件都折叠在了对应的.lex/.y文件之下：</p>\n<p><a href=\"http://catx.me/wordpress/wp-content/uploads/2014/02/yacc-lex-config.png\"><img src=\"/images/664de6c412578efb10f8d11276fe46b559eceace.png\" alt=\"yacc-lex-config\"></a></p>\n<p>编译时的错误信息也会显示在vs中：</p>\n<p><a href=\"http://catx.me/wordpress/wp-content/uploads/2014/02/lex-error.png\"><img src=\"/images/757c2a223d238b4ef3fa0349d6be0704996d7330.png\" alt=\"lex-error\"></a></p>\n<p>和使用pre-build event来实现预编译相比，这种方式最大的优点在于依赖关系明显，不易误操作编辑生成的文件，并且vs只会在.lex/.y文件有变更的情况下重新生成代码。支持按需生成会省不少事，比如在项目中配置了git pre-commit hook要求<a href=\"http://catx.me/2014/01/15/run-msbuild-and-mstest-from-git-pre-commit-hook/\" title=\"通过Git Pre-Commit Hook执行MSBuild和MSTest\">每次commit前检查build和test的正确性</a>，而很多代码自动生成工具会加上时间戳，这样编译一次就会带来文件变更，导致每次commit后都会产生新的diff。</p>\n","date":"2014-02-07T21:10:49.000Z","path":"2014/02/08/visual-studio-gplex-gppg-project-config/","isDark":true,"featureColor":"#2b6a7d","featureImage":"/image/stock/3.jpg","excerpt":"","featureSwatch":{"Vibrant":{"color":"#2b6a7d","isDark":true,"contrast":6.152506571402196},"Muted":{"color":"#628d9b","isDark":true,"contrast":3.8818866665042275},"DarkVibrant":{"color":"#08536a","isDark":true,"contrast":13.30121420712154},"DarkMuted":{"color":"#4d7e8e","isDark":true,"contrast":4.693454244598322},"LightVibrant":{"color":"#74d4e4","isDark":false,"contrast":1.7100585291773622},"LightMuted":{"color":"#769ca9","isDark":false,"contrast":2.958324937392382}},"json":"data/posts/2014/02/08/visual-studio-gplex-gppg-project-config.json","tags":[{"name":".Net","slug":"Net","path":"tags/Net/","permalink":"http://catx.me/tags/Net/","postCount":5},{"name":"CoffeeScript","slug":"CoffeeScript","path":"tags/CoffeeScript/","permalink":"http://catx.me/tags/CoffeeScript/","postCount":9},{"name":"Visual Studio 2012","slug":"Visual-Studio-2012","path":"tags/Visual-Studio-2012/","permalink":"http://catx.me/tags/Visual-Studio-2012/","postCount":2},{"name":"compiler","slug":"compiler","path":"tags/compiler/","permalink":"http://catx.me/tags/compiler/","postCount":5}],"categories":[{"name":"挨踢","slug":"挨踢","path":"categories/挨踢/","permalink":"http://catx.me/categories/挨踢/","postCount":24}]},"sha1":"5fbce7a11aae5a212be0b0c0a4cf5c93fe795a4b","isDigest":true},{"type":"post","json_base":"data/posts","json":"data/posts/2013/02/05/cuda5-visual-studio-2012-fix.json","path":"2013/02/05/cuda5-visual-studio-2012-fix/","data":{"title":"GPU并行编程CUDA5.0+Visual Studio 2012环境配置","content":"<h1 id=\"u95EE_u9898\"><a href=\"#u95EE_u9898\" class=\"headerlink\" title=\"问题\"></a>问题</h1><p>CUDA5.0并不支持Visual Studio 2012的v110 toolchain，所以在安装后尝试编译，会先后遇到如下的错误：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvcc : fatal error : &#39;-ccbin&#39;: expected a number&#10;**nvcc fatal : nvcc cannot find a supported cl version. Only MSVC 8.0 and MSVC 9.0 are supported**</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"u89E3_u51B3_u65B9_u6848_uFF1A\"><a href=\"#u89E3_u51B3_u65B9_u6848_uFF1A\" class=\"headerlink\" title=\"解决方案：\"></a>解决方案：</h1><h2 id=\"1-_u90E8_u7F72/_u4FEE_u6539_u914D_u7F6E_u6587_u4EF6\"><a href=\"#1-_u90E8_u7F72/_u4FEE_u6539_u914D_u7F6E_u6587_u4EF6\" class=\"headerlink\" title=\"1.部署/修改配置文件\"></a>1.部署/修改配置文件</h2><p>在C\\:\\Program Files (x86)\\MSBuild\\Microsoft.Cpp\\v4.0\\V110\\BuildCustomizations文件夹中是MSBuild要完成编译的自定义配置文件，需要手动部署（拷贝）到C:\\Program Files (x86)\\MSBuild\\Microsoft.Cpp\\v4.0\\V110\\BuildCustomizations文件夹下。本文中路径为Win7 64bit默认安装后的路径，根据自己的安装情况调整。</p>\n<p>在这之前需要修改如下文件：</p>\n<p><strong>CUDA5.0.props中</strong></p>\n<p>找到如下行：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&amp;lt;CudaClVersion Condition=\"'$(PlatformToolset)' == 'v90'\"&amp;gt;2008&amp;lt;/CudaClVersion&amp;gt;</span><br><span class=\"line\">&amp;lt;CudaClVersion Condition=\"'$(PlatformToolset)' == 'v100'\"&amp;gt;2010&amp;lt;/CudaClVersion&amp;gt;</span><br></pre></td></tr></table></figure>\n<p>添加：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&amp;lt;CudaClVersion Condition=\"'$(PlatformToolset)' == 'v110'\"&amp;gt;2010&amp;lt;/CudaClVersion&amp;gt;</span><br></pre></td></tr></table></figure>\n<p><strong>CUDA 5.0.targets中</strong></p>\n<p>找到CudaCleanDependsOn标签，改为：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&amp;lt;CudaCleanDependsOn&amp;gt;</span><br><span class=\"line\">  $(CudaCompileDependsOn);</span><br><span class=\"line\">  _SelectedFiles;</span><br><span class=\"line\">  CudaFilterSelectedFiles;</span><br><span class=\"line\">  AddCudaCompileMetadata;</span><br><span class=\"line\">  AddCudaLinkMetadata;</span><br><span class=\"line\">  AddCudaCompileDeps;</span><br><span class=\"line\">  AddCudaCompilePropsDeps;</span><br><span class=\"line\">  ValidateCudaBuild;</span><br><span class=\"line\">  ValidateCudaCodeGeneration;</span><br><span class=\"line\">  ComputeCudaCompileOutput;</span><br><span class=\"line\">  PrepareForCudaBuild</span><br><span class=\"line\">&amp;lt;/CudaCleanDependsOn&amp;gt;</span><br></pre></td></tr></table></figure>\n<p>找到GenerateRelocatableDeviceCode，改为</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GenerateRelocatableDeviceCode=\"%(CudaCompile.GenerateRelocatableDeviceCode)\"</span><br></pre></td></tr></table></figure>\n<p>找到CodeGeneration，改为</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CodeGeneration=\"%(CudaCompile.CodeGenerationValues)\"</span><br></pre></td></tr></table></figure>\n<p>找到CommandLineTemplate，改为</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CommandLineTemplate=\"\"$(CudaToolkitNvccPath)\" %(CudaCompile.BuildCommandLineTemplate) %(CudaCompile.ApiCommandLineTemplate) %(CudaCompile.CleanCommandLineTemplate)\" /&amp;gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-__u4FEE_u6539_u5934_u6587_u4EF6\"><a href=\"#2-__u4FEE_u6539_u5934_u6587_u4EF6\" class=\"headerlink\" title=\"2. 修改头文件\"></a>2. 修改头文件</h2><p>C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v5.0\\include文件夹中，host_config.h文件。</p>\n<p>找到</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"preprocessor\">#<span class=\"keyword\">if</span> _MSC_VER &amp;lt; <span class=\"number\">1400</span> || _MSC_VER &amp;gt; <span class=\"number\">1600</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"preprocessor\">#<span class=\"keyword\">error</span> -- unsupported MSVC version! Only MSVC <span class=\"number\">8.0</span>, <span class=\"number\">9.0</span>, and <span class=\"number\">10.0</span> are supported!</span></span><br></pre></td></tr></table></figure>\n<p>修改为：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"preprocessor\">#<span class=\"keyword\">if</span> _MSC_VER &amp;lt; <span class=\"number\">1400</span> || _MSC_VER &amp;gt; <span class=\"number\">1700</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"preprocessor\">#<span class=\"keyword\">error</span> -- unsupported MSVC version! Only MSVC <span class=\"number\">8.0</span>, <span class=\"number\">9.0</span>, and <span class=\"number\">10.0</span> are supported!</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"3-__u8BED_u6CD5_u9AD8_u4EAE_u652F_u6301\"><a href=\"#3-__u8BED_u6CD5_u9AD8_u4EAE_u652F_u6301\" class=\"headerlink\" title=\"3. 语法高亮支持\"></a>3. 语法高亮支持</h2><ol>\n<li>菜单“Tools-&gt;Options…”，展开左侧“Text Editor”，点击“File Extension”.</li>\n<li>在“Extension”框中输入“cu”, 选择“Microsoft Visual C++”，点击“Add”，捅“OK”。</li>\n<li>重新打开文件</li>\n</ol>\n<p>## </p>\n","date":"2013-02-05T03:37:57.000Z","path":"2013/02/05/cuda5-visual-studio-2012-fix/","isDark":true,"featureColor":"#947444","featureImage":"/image/stock/4.jpg","excerpt":"","featureSwatch":{"Vibrant":{"color":"#947444","isDark":true,"contrast":4.38675255709906},"Muted":{"color":"#8b704c","isDark":true,"contrast":4.720403801183811},"DarkVibrant":{"color":"#2c2214","isDark":true,"contrast":17.310047977134303},"DarkMuted":{"color":"#3e3121","isDark":true,"contrast":16.064607088557274},"LightVibrant":{"color":"#dcac74","isDark":false,"contrast":2.059564738834789}},"json":"data/posts/2013/02/05/cuda5-visual-studio-2012-fix.json","tags":[{"name":"CUDA","slug":"CUDA","path":"tags/CUDA/","permalink":"http://catx.me/tags/CUDA/","postCount":1},{"name":"GPU","slug":"GPU","path":"tags/GPU/","permalink":"http://catx.me/tags/GPU/","postCount":1},{"name":"Visual Studio 2012","slug":"Visual-Studio-2012","path":"tags/Visual-Studio-2012/","permalink":"http://catx.me/tags/Visual-Studio-2012/","postCount":2}],"categories":[{"name":"挨踢","slug":"挨踢","path":"categories/挨踢/","permalink":"http://catx.me/categories/挨踢/","postCount":24}]},"sha1":"39ec1ac0fa60b1476d4dc20d9d1ac52eb6cdc4fe","isDigest":true}],"sha1":"f4419fd063229339e1f498ba7c72f74285fc8b89"}